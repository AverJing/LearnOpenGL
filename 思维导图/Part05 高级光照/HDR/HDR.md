#### HDR

------------------

##### 概念

- 为什么要引入HDR？
  - 颜色和亮度显示精度的问题，被限制在0.0到1.0之间，如果场景中大量片段颜色值都非常接近1.0，那么很大一个区域都有相同的白色光，损失较多的细节。
  - 可以考虑减少光源的强度，让片段中没有高于1.0的，效果可想而知
  - **更好的方法**，让颜色暂时超过1.0，然后将其转换到0.0到1.0之间，从而防止损失细节，也就是HDR
- High Dynamic Range
  - HDR渲染和其很相似，我们允许用更大范围的颜色值渲染从而获取大范围的黑暗与明亮的场景细节，最后将所有HDR值转换成在[0.0, 1.0]范围的**LDR(Low Dynamic Range,低动态范围)**。
  - 转换HDR值到LDR值得过程叫做**色调映射(Tone Mapping)**，现在现存有很多的色调映射算法，这些算法致力于在转换过程中保留尽可能多的HDR细节。这些色调映射算法经常会包含一个选择性倾向黑暗或者明亮区域的参数。

##### OpenGL中的使用

- 浮点帧缓冲
  - 当一个帧缓冲的颜色缓冲的内部格式被设定成了`GL_RGB16F`, `GL_RGBA16F`, `GL_RGB32F` 或者`GL_RGBA32F`时，这些帧缓冲被叫做浮点帧缓冲(Floating Point Framebuffer)，**浮点帧缓冲可以存储超过0.0到1.0范围的浮点值**，所以非常适合HDR渲染。
  - 当帧缓冲使用标准的定点格式（比如GL_RGB）为其颜色缓冲的内部格式，默认会处理为0.0到1.0之间。
- 色彩映射
  - 色调映射(Tone Mapping)是一个损失很小的转换浮点颜色值至我们所需的LDR[0.0, 1.0]范围内的过程，通常会伴有特定的风格的色平衡(Stylistic Color Balance)。
  - Reinhard色调映射
    - `// Reinhard色调映射
      vec3 mapped = hdrColor / (hdrColor + vec3(1.0));`
    - 这个算法是倾向明亮的区域的，暗的区域会不那么精细也不那么有区分度。
  - 结合**曝光(Exposure)参数**的使用
    - `// 曝光色调映射
      vec3 mapped = vec3(1.0) - exp(-hdrColor * exposure);`
    - **高曝光值**会使隧道的**黑暗部分显示更多的细节**，然而**低曝光值**会显著**减少黑暗区域的细节**
- 拓展
  - 一些色调映射算法倾向于**特定的某种颜色/强度，**
  - 也有一些算法同时**显示低于高曝光颜色从而能够显示更加多彩和精细的图像**。
  - 也有一些技巧被称作自动曝光调整(Automatic Exposure Adjustment)或者叫人眼适应(Eye Adaptation)技术，它能够检测前一帧场景的亮度并且缓慢调整曝光参数模仿人眼使得场景在黑暗区域逐渐变亮或者在明亮区域逐渐变暗，

​	

















































